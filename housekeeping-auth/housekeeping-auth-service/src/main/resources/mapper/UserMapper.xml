<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.housekeeping.auth.mapper.UserMapper">

	<insert id="insertOne">
		INSERT INTO `sys_user`(`number`, nickname, `name`, date_of_birth, phone, email, password, create_time, update_time, last_reviser_id)
		VALUES(
			#{number},
			#{userDTO.nickname},
			#{userDTO.name},
			#{userDTO.dateOfBirth},
			#{userDTO.phone},
			#{userDTO.email},
			#{userDTO.password},
			now(),
			now(),
			#{lastReviserId}
		)
	</insert>
	<update id="changePasswordByPhone">
		UPDATE `sys_user`
		SET password = #{newPassword}
		WHERE phone = #{phone}
	</update>

	<update id="bindingEmailByUserId">
		UPDATE sys_user
		SET email = #{email}
		WHERE id = #{userId}
    </update>

    <update id="updatePassword">
		UPDATE sys_user SET `password` = #{encryptString} WHERE id = #{currentUserId}
	</update>

    <update id="changePhone">
		UPDATE sys_user SET phone = #{phone},phone_prefix = #{phonePrefix} WHERE id = #{currentUserId}
	</update>

    <select id="getDeptIdByUserId" resultType="java.lang.Integer">
		SELECT dept_id
		FROM sys_user
		WHERE id = #{userId}
	</select>

	<select id="getOne" resultType="com.housekeeping.admin.entity.User">
		SELECT *
		FROM sys_user
		WHERE dept_id = #{deptId}, email = #{email}
	</select>

    <select id="getPassword" resultType="java.lang.String">
		SELECT password FROM sys_user WHERE id = #{currentUserId}
	</select>

    <select id="getPhone" resultType="java.lang.String">
		SELECT phone FROM sys_user WHERE id = #{currentUserId}
	</select>
	<select id="getPre" resultType="java.lang.String">
		SELECT phone_prefix FROM sys_user WHERE id = #{currentUserId}
	</select>

	<update id="changeEmpPhone">
		UPDATE employees_details SET phone = #{phone},phone_prefix = #{phonePrefix} WHERE user_id = #{currentUserId}
	</update>
</mapper>
