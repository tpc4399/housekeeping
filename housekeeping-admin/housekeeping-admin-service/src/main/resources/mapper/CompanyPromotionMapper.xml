<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.housekeeping.admin.mapper.CompanyPromotionMapper">

	<resultMap id="baseResultMap" type="com.housekeeping.admin.dto.CompanyPromotionDTO">
		<id property="id" column="id"/>
		<result property="companyId" column="company_id"/>
		<result property="promotion" column="promotion"/>
		<result property="endTime" column="end_time"/>
		<result property="days" column="days"/>
		<result property="tokens" column="tokens"/>
		<result property="companyName" column="company_name"/>
	</resultMap>
	<resultMap id="baseResultMap1" type="com.housekeeping.admin.dto.CompanyDetailsPromotionDTO">
		<id property="companyId" column="id"/>
		<result property="number" column="number"/>
		<result property="companyName" column="company_name"/>
		<result property="companyProfile" column="company_profile"/>
		<result property="logoUrl" column="logo_url"/>
		<result property="tokens" column="tokens"/>
		<result property="promotion" column="promotion"/>
		<result property="startTime" column="start_time"/>
		<result property="endTime" column="end_time"/>
	</resultMap>

	<select id="getInfoById" resultMap="baseResultMap">
		SELECT
			cp.id,
			cp.company_id,
			cp.days,
			cp.promotion,
			cp.end_time,
			cd.tokens,
			cd.company_name
		FROM
			company_promotion AS cp
		LEFT JOIN company_details AS cd ON cp.company_id = cd.id
		WHERE company_id = #{companyId}
	</select>

	<select id="getCompanyByRan" resultType="java.lang.Integer">
		SELECT
		id
		FROM
		company_promotion
		WHERE end_time > NOW()
		order by rand() limit #{random}
	</select>

	<select id="getAllProCompIds" resultType="java.lang.Integer">
		SELECT
		id
		FROM
		company_promotion
		WHERE end_time > NOW()
	</select>

	<select id="getInfoByAdmin" resultMap="baseResultMap1">
		SELECT
		cd.id,
		cd.number,
		cd.company_name,
		cd.company_profile,
		cd.logo_url,
		cd.tokens,
		cp.promotion,
		cp.start_time,
		cp.end_time
		FROM
		company_details AS cd
		LEFT JOIN company_promotion cp ON cd.id = cp.company_id
		<where>
			<if test=" id != null and  id != ''">
				cd.id =  #{id}
			</if>
			<if test=" name != null and  name != ''">
				and cd.company_name like concat('%',#{name},'%')
			</if>
		</where>
	</select>

</mapper>
